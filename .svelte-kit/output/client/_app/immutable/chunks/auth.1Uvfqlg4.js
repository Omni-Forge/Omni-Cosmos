import{w as l}from"./index.CEIXVWp1.js";import{g as n}from"./entry.9noDchyj.js";import{H as s,I as i}from"./runtime.BpsoJ9mv.js";const u=s,k=i;function c(){const{subscribe:a,set:t,update:f}=l({isAuthenticated:!1,token:null,user:null,error:null,loading:!0});return{subscribe:a,login:async r=>{try{const e=await fetch("/v3/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error("Login failed");const o=await e.json();t({isAuthenticated:!0,token:o.token,user:o.user,error:null,loading:!1}),u&&localStorage.setItem("cf_token",o.token),n("/dashboard")}catch(e){t({isAuthenticated:!1,token:null,user:null,error:e.message,loading:!1})}},logout:()=>{localStorage.removeItem("cf_token"),t({isAuthenticated:!1,token:null,user:null,error:null,loading:!1}),n("/login")},checkAuth:async()=>{const r=localStorage.getItem("cf_token");if(!r)return t({isAuthenticated:!1,token:null,user:null,error:null,loading:!1}),!1;try{const e=await fetch("/v3/profile",{headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error("Invalid token");const o=await e.json();return t({isAuthenticated:!0,token:r,user:o,error:null,loading:!1}),!0}catch(e){return t({isAuthenticated:!1,token:null,user:null,error:e.message,loading:!1}),!1}}}}const m=c();export{m as a,k as d};
