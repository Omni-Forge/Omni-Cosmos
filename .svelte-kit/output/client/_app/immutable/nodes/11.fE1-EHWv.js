import{t as v,a as m}from"../chunks/disclose-version.N1JcEE3x.js";import{i as _e}from"../chunks/legacy.Bq8hjaPg.js";import{p as ye,l as oe,g as e,m as x,d as E,b as h,e as we,s as d,c as i,t as _,i as V,a as ke,r as l,n as ne}from"../chunks/runtime.BpsoJ9mv.js";import{s as Ve,b as $e,a as j,e as H}from"../chunks/store.CIqAHlUC.js";import{i as B}from"../chunks/index-client.CY8cH23_.js";import{e as I,i as M}from"../chunks/Icon.oS-Lt7LZ.js";import{a as $,r as P}from"../chunks/attributes.C59D3o5x.js";import{b as ue,a as ce}from"../chunks/input.BWE0VUSD.js";import{b as qe}from"../chunks/select.DFFMRfw6.js";import{p as Se}from"../chunks/event-modifiers.CWmzcjye.js";import{p as Ae}from"../chunks/stores.8gzRtGeB.js";import{g as de}from"../chunks/entry.9noDchyj.js";import{A as Ce,S as De}from"../chunks/Slider.ZgKB-WUs.js";import{S as Ee}from"../chunks/server.CxxYWvAu.js";import{M as je,C as Be}from"../chunks/memory-stick.eMLVWtN5.js";import{D as Ie}from"../chunks/database.mMrgwlhs.js";import{P as Me}from"../chunks/play.B-PMHxGu.js";var Pe=v("<option> </option>"),Fe=v('<select class="w-full px-3 py-2 bg-neutral-900 border border-neutral-800 rounded-lg focus:outline-none focus:border-blue-500"></select>'),Re=v('<input class="w-full px-3 py-2 bg-neutral-900 border border-neutral-800 rounded-lg focus:outline-none focus:border-blue-500">'),Ue=v('<div class="space-y-2"><label class="block text-sm font-medium"> </label> <!></div>'),Ge=v('<div class="space-y-4"><h2 class="text-lg font-medium text-white">Source Configuration</h2> <div class="space-y-4"></div></div>'),Le=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>'),Ne=v(`<div class="space-y-4"><div class="bg-neutral-800 rounded-lg p-4"><h3 class="text-sm font-medium text-white mb-4">AI-powered Scaling</h3> <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"> <div class="w-11 h-6 bg-neutral-700 peer-focus:outline-none rounded-full peer 
                        peer-checked:after:translate-x-full peer-checked:after:border-white 
                        after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
                        after:bg-white after:border-gray-300 after:border after:rounded-full 
                        after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div> <span class="ml-2">Use AI scaling engine (ACE)</span></label></div> <!></div>`),Oe=v('<div class="p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400"> </div>'),Te=v(`<div class="max-w-4xl mx-auto my-8"><form class="space-y-6"><div class="space-y-4"><h2 class="text-lg font-medium text-white">Application Details</h2> <div class="space-y-2"><label for="name" class="block text-sm font-medium">Application Name</label> <input id="name" type="text" required class="w-full px-3 py-2 bg-neutral-900 border border-neutral-800 rounded-lg focus:outline-none focus:border-blue-500" placeholder="my-application"></div></div> <!> <div class="space-y-4"><div class="flex justify-between items-center"><h2 class="text-lg font-medium text-white">Resource Configuration</h2> <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"> <div class="w-11 h-6 bg-neutral-700 peer-focus:outline-none rounded-full peer 
                      peer-checked:after:translate-x-full peer-checked:after:border-white 
                      after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
                      after:bg-white after:border-gray-300 after:border after:rounded-full 
                      after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div> <span class="ml-2">Enable Autoscaling</span></label></div> <!></div> <!> <div class="flex justify-end space-x-4"><button type="button" class="px-6 py-2 bg-neutral-800 hover:bg-neutral-700 rounded-lg transition-colors">Cancel</button> <button type="submit" class="flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50"><!> <span> </span></button></div></form></div>`);function na(pe,me){ye(me,!1);const ve=Ve(),K=()=>$e(Ae,"$page",ve),q=x(),S=K().url.searchParams.get("source"),{orgId:F,spaceId:R}=K().params;let A=x(!1),C=x(null),y=x(!1),U=x(!1),o=x({name:"",instances:1,memory:256,disk_quota:512,cpu_limit:100,source_config:{},env:{}});function W(a){switch(a){case"github":return[{id:"repo",label:"Repository",type:"text",placeholder:"owner/repo",required:!0},{id:"branch",label:"Branch",type:"text",placeholder:"main",required:!0}];case"gitlab":return[{id:"project",label:"Project",type:"text",placeholder:"group/project",required:!0},{id:"branch",label:"Branch",type:"text",placeholder:"main",required:!0}];case"git":return[{id:"url",label:"Repository URL",type:"text",placeholder:"https://github.com/user/repo.git",required:!0},{id:"branch",label:"Branch",type:"text",placeholder:"main",required:!0}];case"docker":return[{id:"image",label:"Image",type:"text",placeholder:"nginx:latest",required:!0}];case"shell":return[];default:return[]}}let s=x([{icon:Ee,title:"Application Instances",value:1,minValue:1,maxValue:10,min:1,max:20,step:1,format:a=>a.toString()},{icon:je,title:"Memory per Instance",value:256,minValue:256,maxValue:512,min:128,max:4096,step:128,format:a=>a>=1024?`${(a/1024).toFixed(1)}GB`:`${a}MB`},{icon:Ie,title:"Disk Quota",value:512,minValue:512,maxValue:1024,min:512,max:8192,step:512,format:a=>a>=1024?`${(a/1024).toFixed(1)}GB`:`${a}MB`},{icon:Be,title:"CPU Limit",value:100,minValue:0,maxValue:400,min:0,max:400,step:5,format:a=>`${a}%`}]);function be(){e(y)||e(s).forEach(a=>{a.minValue=a.value,a.maxValue=a.value})}async function fe(){h(A,!0),h(C,null);try{const a=e(q).reduce((t,b)=>(t[b.id]=e(o)[b.id],t),{}),r={...e(o),source_type:S,source_config:a,instances:e(s)[0].value,memory:e(s)[1].value,disk_quota:e(s)[2].value,cpu_limit:e(s)[3].value};e(y)&&(r.autoscaling={enabled:!0,ace_enabled:e(U),instances:{min:e(s)[0].bind.min,max:e(s)[0].bind.max},memory:{min:e(s)[1].bind.min,max:e(s)[1].bind.max},disk:{min:e(s)[2].bind.min,max:e(s)[2].bind.max},cpu:{min:e(s)[3].bind.min,max:e(s)[3].bind.max}});const p=await fetch(`/api/orgs/${F}/spaces/${R}/apps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!p.ok)throw new Error("Failed to create application");const n=await p.json();de(`/app/org/${F}/spaces/${R}/applications/${n.guid}`)}catch(a){h(C,a instanceof Error?a.message:"An error occurred while creating the application"),console.error("Deployment error:",a)}finally{h(A,!1)}}oe(()=>e(o),()=>{S&&W(S).forEach(r=>{r.id in e(o)||E(o,e(o)[r.id]="")})}),oe(()=>{},()=>{h(q,W(S??""))}),we(),_e();var G=Te(),L=i(G),N=i(L),X=d(i(N),2),Y=d(i(X),2);P(Y),l(X),l(N);var Z=d(N,2);B(Z,()=>e(q).length>0,a=>{var r=Ge(),p=d(i(r),2);I(p,5,()=>e(q),M,(n,t)=>{var b=Ue(),f=i(b),u=i(f,!0);l(f);var g=d(f,2);B(g,()=>e(t).type==="select",z=>{var c=Fe();_(()=>{e(o)[e(t).id],V(()=>{e(t)})}),I(c,5,()=>e(t).options||[],M,(w,D)=>{var k=Pe(),ie={},he=i(k,!0);l(k),_(()=>{ie!==(ie=e(D).value)&&(k.value=(k.__value=e(D).value)==null?"":e(D).value),j(he,e(D).label)}),m(w,k)}),l(c),_(()=>{$(c,"id",e(t).id),c.required=e(t).required}),qe(c,()=>e(o)[e(t).id],w=>E(o,e(o)[e(t).id]=w)),m(z,c)},z=>{var c=Re();P(c),_(()=>{$(c,"id",e(t).id),$(c,"type",e(t).type),c.required=e(t).required,$(c,"placeholder",e(t).placeholder)}),ue(c,()=>e(o)[e(t).id],w=>E(o,e(o)[e(t).id]=w)),m(z,c)}),l(b),_(()=>{$(f,"for",e(t).id),j(u,e(t).label)}),m(n,b)}),l(p),l(r),m(a,r)});var O=d(Z,2),T=i(O),ee=d(i(T),2),J=i(ee);P(J),ne(4),l(ee),l(T);var ge=d(T,2);B(ge,()=>!e(y),a=>{var r=Le();I(r,5,()=>e(s),M,(p,n)=>{De(p,{get icon(){return e(n).icon},get title(){return e(n).title},get value(){return e(n).value},set value(t){e(n).value=t,V(()=>e(s))},get min(){return e(n).min},get max(){return e(n).max},get step(){return e(n).step},get formatValue(){return e(n).format},$$legacy:!0})}),l(r),m(a,r)},a=>{var r=Ne(),p=i(r),n=d(i(p),2),t=i(n);P(t),ne(4),l(n),l(p);var b=d(p,2);I(b,1,()=>e(s),M,(f,u)=>{Ce(f,{get icon(){return e(u).icon},get title(){return e(u).title},get minValue(){return e(u).minValue},set minValue(g){e(u).minValue=g,V(()=>e(s))},get maxValue(){return e(u).maxValue},set maxValue(g){e(u).maxValue=g,V(()=>e(s))},get value(){return e(u).value},set value(g){e(u).value=g,V(()=>e(s))},get min(){return e(u).min},get max(){return e(u).max},get step(){return e(u).step},get formatValue(){return e(u).format},$$legacy:!0})}),l(r),ce(t,()=>e(U),f=>h(U,f)),m(a,r)}),l(O);var ae=d(O,2);B(ae,()=>e(C),a=>{var r=Oe(),p=i(r,!0);l(r),_(()=>j(p,e(C))),m(a,r)});var te=d(ae,2),re=i(te),Q=d(re,2),le=i(Q);Me(le,{class:"w-4 h-4"});var se=d(le,2),xe=i(se,!0);l(se),l(Q),l(te),l(L),l(G),_(()=>{Q.disabled=e(A),j(xe,e(A)?"Deploying...":"Deploy Application")}),ue(Y,()=>e(o).name,a=>E(o,e(o).name=a)),ce(J,()=>e(y),a=>h(y,a)),H("change",J,be),H("click",re,()=>de(`/app/org/${F}/spaces/${R}/applications`)),H("submit",L,Se(fe)),m(pe,G),ke()}export{na as component};
